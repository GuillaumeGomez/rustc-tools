<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="rustc-tools"><title>rustc_tools - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-fa3bb1812debf86c.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="rustc_tools" data-themes="" data-resource-suffix="" data-rustdoc-version="1.75.0-nightly (cae0791da 2023-10-05)" data-channel="nightly" data-search-js="search-8be46b629f5f14a8.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-c5bd66d33317d69f.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../rustc_tools/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a></nav><nav class="sidebar"><a class="logo-container" href="../rustc_tools/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate rustc_tools</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.3.3</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">rustc_tools</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/rustc_tools/lib.rs.html#1-43">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="rustc-tools"><a href="#rustc-tools">rustc-tools</a></h2>
<p>Some internal rustc tools made accessible (by wrapping the setup part away).</p>
<p>API documentation is available <a href="https://guillaumegomez.github.io/rustc-tools/index.html">here</a>.</p>
<h3 id="why-would-i-need-this-crate"><a href="#why-would-i-need-this-crate">Why would I need this crate?</a></h3>
<p>If you need to write a Rust compiler plugin (<code>clippy</code> and <code>rustdoc</code> are good examples of what a rustc plugin can achieve), a lot of setup is required to be able to use its APIs. This crate aims at removing this pain point so you can spend more time working on the plugin instead.</p>
<h3 id="how-to-use-it"><a href="#how-to-use-it">How to use it?</a></h3>
<p>Since it provides and uses <code>rustc</code> API, it only works on a very specific nightly version of the Rust compiler. Copy the <code>rust-toolchain</code> file into your project.</p>
<p>Another thing required: you need to add <code>#![feature(rustc_private)</code> in your crate to be able to use <code>rustc_tools</code>.</p>
<p>Once done, that’s it!</p>
<h3 id="global-explanations"><a href="#global-explanations">Global explanations</a></h3>
<p>In the Rust compiler, there are multiple levels to handle APIs. The lower you go, the more information you have. What follows are very simplified explanations:</p>
<p>First, you have the <code>lexer</code>. It is an iterator which goes through a string (a source code file) and tries to parse it as Rust code. It doesn’t do anything else like trying to follow module declarations or anything, it just generates syntax information.</p>
<p>Then, you have the <code>ast</code> which gives more information about what you’re reading and classifies it. For example, you don’t have just tokens anymore but <em>items</em>. At this level, you can start using visitors as you already have some nice information like attributes, visibility, etc. Take a look at <code>examples/ast.rs</code> to see an example.</p>
<p>The final level covered by this crate is <code>HIR</code> (for High-level Intermediate Representation). You get it after macro expansion and name resolution. It is made to be a compiler-friendly AST. As such, you can start using the internal Rust compiler query system with it.</p>
<p>If you want more information about all this, I strongly recommend you to go read the <a href="https://rustc-dev-guide.rust-lang.org/">rustc dev guide</a> and to take a look at the <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/index.html">compiler documentation</a> (and in particular the <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/struct.TyCtxt.html"><code>TyCtxt</code></a> and <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html"><code>Map</code></a> types, both of which are at the center of the <code>HIR</code> level).</p>
<h3 id="running-examples"><a href="#running-examples">Running examples</a></h3>
<p>There are a few examples available in the <code>examples</code> folder. To run them:</p>
<div class="example-wrap"><pre class="language-bash"><code>$ cargo run --example ast -- asset/example_file.rs
$ cargo run --example hir -- asset/example_file.rs
$ cargo run --example lint -- asset/example_file.rs
</code></pre></div>
<p>A more complete example with cargo integration is available <a href="https://github.com/GuillaumeGomez/rustc-tools-example">here</a>.</p>
</div></details><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.Error.html" title="enum rustc_tools::Error">Error</a></div><div class="desc docblock-short">Error returned by the API. If the parser encounters a problem, it’ll always be <code>Error::Parser</code>.
<code>Error::Other</code> is for users.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.cargo_integration.html" title="fn rustc_tools::cargo_integration">cargo_integration</a></div><div class="desc docblock-short">Allows your rustc plugin to run directly with cargo integration. Quite useful in case you are
writing a cargo tool.</div></li><li><div class="item-name"><a class="fn" href="fn.get_supported_rustc_version.html" title="fn rustc_tools::get_supported_rustc_version">get_supported_rustc_version</a></div><div class="desc docblock-short">Returns the rustc version <code>rustc-tools</code> is currently using.</div></li><li><div class="item-name"><a class="fn" href="fn.lexer.html" title="fn rustc_tools::lexer">lexer</a></div><div class="desc docblock-short">Very basic lexer which return a lexer iterator. It doesn’t handle errors or anything. For more
advanced usage, take a look at <a href="fn.with_ast_parser.html" title="fn rustc_tools::with_ast_parser"><code>with_ast_parser</code></a> instead.</div></li><li><div class="item-name"><a class="fn" href="fn.with_ast_parser.html" title="fn rustc_tools::with_ast_parser">with_ast_parser</a></div><div class="desc docblock-short">You can check <code>ParseSess</code> documentation <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_session/parse/struct.ParseSess.html">here</a>
and <code>Crate</code> documentation <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_ast/ast/struct.Crate.html">here</a>.</div></li><li><div class="item-name"><a class="fn" href="fn.with_lints.html" title="fn rustc_tools::with_lints">with_lints</a></div><div class="desc docblock-short">If you want to create a linter, this the function you want to use.</div></li><li><div class="item-name"><a class="fn" href="fn.with_tyctxt.html" title="fn rustc_tools::with_tyctxt">with_tyctxt</a></div><div class="desc docblock-short">If you need more information than what is provided by
<a href="fn.with_ast_parser.html" title="fn rustc_tools::with_ast_parser"><code>with_ast_parser</code></a>, this is the function you will use.</div></li></ul></section></div></main></body></html>