<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Lowers the AST to the HIR."><title>rustc_ast_lowering - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-5ca6ca2a1f83705a.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="rustc_ast_lowering" data-themes="" data-resource-suffix="" data-rustdoc-version="1.82.0-dev" data-channel="nightly" data-search-js="search-d234aafac6c221dd.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-d2fab2bf619172d3.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button><a class="logo-container" href="../rustc_ast_lowering/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt=""></a></nav><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../rustc_ast_lowering/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2><a href="../rustc_ast_lowering/index.html">rustc_ast_lowering</a><span class="version">1.82.0-dev</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#statics">Statics</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">rustc_ast_lowering</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/rustc_ast_lowering/lib.rs.html#1-2749">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Lowers the AST to the HIR.</p>
<p>Since the AST and HIR are fairly similar, this is mostly a simple procedure,
much like a fold. Where lowering involves a bit more work things get more
interesting and there are some invariants you should know about. These mostly
concern spans and IDs.</p>
<p>Spans are assigned to AST nodes during parsing and then are modified during
expansion to indicate the origin of a node and the process it went through
being expanded. IDs are assigned to AST nodes just before lowering.</p>
<p>For the simpler lowering steps, IDs and spans should be preserved. Unlike
expansion we do not preserve the process of lowering in the spans, so spans
should not be modified here. When creating a new node (as opposed to
“folding” an existing one), create a new ID using <code>next_id()</code>.</p>
<p>You must ensure that IDs are unique. That means that you should only use the
ID from an AST node in a single HIR node (you can assume that AST node-IDs
are unique). Every new node must have a unique ID. Avoid cloning HIR nodes.
If you do, you must then set the new node’s ID to a fresh one.</p>
<p>Spans are used for error messages and for tools to map semantics back to
source code. It is therefore not as important with spans as IDs to be strict
about use (you can’t break the compiler by screwing up a span). Obviously, a
HIR node can only have a single span. But multiple nodes can have the same
span and spans don’t need to be kept in order, etc. Where code is preserved
by lowering, it should have the same span as in the AST. Where HIR nodes are
new it is probably best to give a span for the whole AST node being lowered.
All nodes should have real spans; don’t use dummy spans. Tools are likely to
get confused if the spans from leaf AST nodes occur in multiple places
in the HIR, especially for multiple identifiers.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="asm/index.html" title="mod rustc_ast_lowering::asm">asm</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="block/index.html" title="mod rustc_ast_lowering::block">block</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="delegation/index.html" title="mod rustc_ast_lowering::delegation">delegation</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">This module implements expansion of delegation items with early resolved paths.
It includes a delegation to a free functions:</div></li><li><div class="item-name"><a class="mod" href="errors/index.html" title="mod rustc_ast_lowering::errors">errors</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="expr/index.html" title="mod rustc_ast_lowering::expr">expr</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="format/index.html" title="mod rustc_ast_lowering::format">format</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="index/index.html" title="mod rustc_ast_lowering::index">index</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="item/index.html" title="mod rustc_ast_lowering::item">item</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="lifetime_collector/index.html" title="mod rustc_ast_lowering::lifetime_collector">lifetime_collector</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="pat/index.html" title="mod rustc_ast_lowering::pat">pat</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="path/index.html" title="mod rustc_ast_lowering::path">path</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li></ul><h2 id="macros" class="section-header">Macros<a href="#macros" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="macro" href="macro.arena_vec.html" title="macro rustc_ast_lowering::arena_vec">arena_vec</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.GenericArgsCtor.html" title="struct rustc_ast_lowering::GenericArgsCtor">GenericArgsCtor</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Helper struct for the delayed construction of <a href="../rustc_hir/hir/struct.GenericArgs.html" title="struct rustc_hir::hir::GenericArgs"><code>hir::GenericArgs</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.LoweringContext.html" title="struct rustc_ast_lowering::LoweringContext">LoweringContext</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.AstOwner.html" title="enum rustc_ast_lowering::AstOwner">AstOwner</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="enum" href="enum.FnDeclKind.html" title="enum rustc_ast_lowering::FnDeclKind">FnDeclKind</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="enum" href="enum.ImplTraitContext.html" title="enum rustc_ast_lowering::ImplTraitContext">ImplTraitContext</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Context of <code>impl Trait</code> in code, which determines whether it is allowed in an HIR subtree,
and if so, what meaning it has.</div></li><li><div class="item-name"><a class="enum" href="enum.ImplTraitPosition.html" title="enum rustc_ast_lowering::ImplTraitPosition">ImplTraitPosition</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Position in which <code>impl Trait</code> is disallowed.</div></li><li><div class="item-name"><a class="enum" href="enum.ParamMode.html" title="enum rustc_ast_lowering::ParamMode">ParamMode</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="enum" href="enum.ParenthesizedGenericArgs.html" title="enum rustc_ast_lowering::ParenthesizedGenericArgs">ParenthesizedGenericArgs</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li></ul><h2 id="statics" class="section-header">Statics<a href="#statics" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="static" href="static.DEFAULT_LOCALE_RESOURCE.html" title="static rustc_ast_lowering::DEFAULT_LOCALE_RESOURCE">DEFAULT_LOCALE_RESOURCE</a></div><div class="desc docblock-short">Raw content of Fluent resource for this crate, generated by <code>fluent_messages</code> macro,
imported by <code>rustc_driver</code> to include all crates’ resources in one bundle.</div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.ResolverAstLoweringExt.html" title="trait rustc_ast_lowering::ResolverAstLoweringExt">ResolverAstLoweringExt</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.compute_hir_hash.html" title="fn rustc_ast_lowering::compute_hir_hash">compute_hir_hash</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Compute the hash for the HIR of the full crate.
This hash will then be part of the crate_hash which is stored in the metadata.</div></li><li><div class="item-name"><a class="fn" href="fn.index_crate.html" title="fn rustc_ast_lowering::index_crate">index_crate</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="fn" href="fn.lower_to_hir.html" title="fn rustc_ast_lowering::lower_to_hir">lower_to_hir</a></div></li></ul></section></div></main></body></html>